<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ìœ ë¹ˆì´  ê°€ì¡± ì—¬í–‰ ë¯¸ì…˜</title>

<!-- iOS ì›¹ì•± ì„¤ì • -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="ê°€ì¡± ì—¬í–‰" />
<link rel="apple-touch-icon" href="icon.png" />
<meta name="theme-color" content="#ffb3c9" />

<style>
  :root{
    --bg-grad: radial-gradient(1200px 800px at 20% -10%, rgba(255,210,230,.65), transparent 60%),
               radial-gradient(1000px 700px at 110% 110%, rgba(255,235,200,.35), transparent 58%),
               linear-gradient(135deg, #ffe1eb, #ffc6d9 45%, #ffb3c9 70%, #f8a6d1 100%);
    --card-bg: rgba(255,255,255,.94);
    --text: #242424;
    --muted: #6b6b6b;
    --accent-grad: linear-gradient(90deg, #ff6aa3, #ffb0d4);
    --btn-grad: linear-gradient(90deg, #ff6aa3, #ff2d6f);
    --chip-bg: rgba(255,255,255,.7);
    --chip-text: #a0225a;
    --radius: 18px;
    --dock-h: 72px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg-grad) fixed; color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display","Noto Sans KR",system-ui,sans-serif;
    letter-spacing:.1px;
    padding-top:calc(env(safe-area-inset-top));
    padding-bottom:calc(var(--dock-h) + env(safe-area-inset-bottom) + 12px);
  }

  /* íƒ€ì´í‹€ ê°€ë…ì„± í–¥ìƒ */
  .title-wrap{position:sticky;top:0;z-index:5;padding-top:calc(env(safe-area-inset-top));}
  .navbar{
    padding:20px 20px 6px;
    font-size:30px; font-weight:900; text-align:center; color:#fff;
    text-shadow:0 2px 6px rgba(0,0,0,.25), 0 0 1px rgba(0,0,0,.35);
    -webkit-text-stroke: .6px rgba(0,0,0,.15);
  }
  .subtitle{
    text-align:center; font-size:14px; font-weight:800; letter-spacing:.1px; color:#ffffff;
    margin:0 auto 14px; padding:8px 14px; width:max-content; max-width:calc(100% - 32px);
    background:rgba(0,0,0,.18); border-radius:999px;
    box-shadow:0 2px 8px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.35);
    backdrop-filter:saturate(1.2) blur(6px);
  }

  /* í”„ë¡œí•„ í—¤ë” */
  .profile{max-width:980px; margin:0 auto 10px; padding:0 16px;}
  .profile-card{position:relative; background:linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,.18)); border-radius:28px; overflow:hidden; box-shadow:0 14px 30px rgba(0,0,0,.08); backdrop-filter: blur(10px);} 
  .profile-cover{height:140px; background:radial-gradient(500px 240px at 10% 0%, rgba(255,210,230,.55), transparent 60%), radial-gradient(420px 240px at 95% 100%, rgba(255,235,200,.45), transparent 55%), linear-gradient(135deg, #ffd7e6, #ffbfd7 45%, #ffb3c9 80%, #f7a2cf 100%);} 
  .profile-row{display:flex; align-items:center; gap:14px; padding:0 16px 16px; margin-top:-42px;} 
  /* ì•„ë°”íƒ€: P.PNG ìš°ì„ , ì—†ìœ¼ë©´ icon.png */
  .avatar{width:96px; height:96px; border-radius:28px; background:#fff url('P.png'), #fff url('icon.png'); background-position:center; background-size:cover; background-repeat:no-repeat; box-shadow:0 8px 24px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.7); border:4px solid rgba(255,255,255,.85); flex:0 0 auto;}
  .pmeta{color:#2c2c2c;} .pname{font-size:22px; font-weight:900; letter-spacing:.2px;} .pdesc{margin-top:4px; color:#7a2a52; font-weight:700;}
  .ptags{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;} .ptag{background:var(--chip-bg); color:var(--chip-text); padding:6px 10px; border-radius:999px; font-weight:700; font-size:13px; backdrop-filter: blur(6px); box-shadow:0 1px 0 rgba(255,255,255,.6) inset, 0 6px 16px rgba(0,0,0,.05);} 

  .container{max-width:900px;margin:0 auto; padding:16px 16px 24px;}
  .card{background:var(--card-bg); color:var(--text); border-radius:var(--radius); padding:16px; margin-bottom:14px; box-shadow:0 10px 28px rgba(0,0,0,.06);} 
  .sec-title{font-weight:800; margin:4px 0 12px; font-size:18px; display:flex; align-items:center; gap:8px} .sec-title .ico{font-size:18px}
  .row2{display:grid; grid-template-columns:1fr 1fr; gap:10px} @media (max-width:720px){ .row2{grid-template-columns:1fr} }
  .field{display:flex; gap:8px; margin-bottom:10px;}
  input, textarea{flex:1; padding:13px 14px; border:none; border-radius:14px; font-size:16px; outline:none; background:#fff; line-height:1.35; color:var(--text); box-shadow: inset 0 0 0 1px rgba(0,0,0,.06), 0 1px 0 rgba(255,255,255,.9);} 
  textarea{min-height:96px; resize:vertical}
  button{border:none; padding:12px 18px; border-radius:14px; font-weight:800; font-size:15px; cursor:pointer; box-shadow:0 6px 16px rgba(255,105,155,.25);} 
  .btn-primary{background:var(--btn-grad); color:#fff;} .btn-ghost{background:rgba(255,255,255,.8); color:#b3124a;}
  .progress{margin-top:6px} .progress .bar{height:12px; border-radius:999px; background:#ffe6f1; overflow:hidden;} .progress .bar>i{display:block; height:100%; background:var(--accent-grad); width:0%; transition:width .25s ease;}
  small.hint{color:var(--muted)}

  /* í•˜ë‹¨ ê³ ì • ë°” */
  .dock{position:fixed; left:0; right:0; bottom:0; padding-bottom:calc(env(safe-area-inset-bottom) + 8px); display:flex; gap:12px; justify-content:center; align-items:center; height:var(--dock-h); background:rgba(255,255,255,.28); backdrop-filter:saturate(1.2) blur(14px); box-shadow:0 -8px 24px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.4); z-index:99;} 
  .dock .dock-btn{min-width:110px; height:48px; padding:0 16px; border-radius:14px; font-weight:900; font-size:15px; display:flex; align-items:center; justify-content:center; gap:8px; background:#fff; color:#b3124a; border:1px solid rgba(0,0,0,.04); box-shadow:0 6px 18px rgba(0,0,0,.06); -webkit-tap-highlight-color:transparent;} 
  .dock .primary{ background:linear-gradient(90deg,#ff6aa3,#ff2d6f); color:#fff; } .dock .ico{font-size:18px; line-height:1}
  @media (max-width:390px){ .dock .dock-btn{ min-width:auto; padding:0 12px; font-size:14px; }}
  .kb-pad{ padding-bottom:calc(var(--dock-h) + 24px); }

  /* ë¯¸ë‹ˆ í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸ ë±ƒì§€ */
  .test-badge{position:fixed; right:10px; bottom:calc(var(--dock-h) + 20px); background:#111; color:#fff; font-size:12px; padding:6px 8px; border-radius:10px; opacity:.85; display:none;}
</style>
</head>

<body>
  <header class="title-wrap">
    <div class="navbar">ë°˜ì„ì´ë„¤ ê°€ì¡± ì—¬í–‰</div>
    <div class="subtitle">ì˜¤í‚¤ë‚˜ì™€ ğŸ‡¯ğŸ‡µ Â· ë°©ì½• ğŸ‡¹ğŸ‡­ â€” ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ì €ì¥ & ë™ê¸°í™”</div>
  </header>

  <!-- í”„ë¡œí•„ -->
  <section class="profile">
    <div class="profile-card">
      <div class="profile-cover"></div>
      <div class="profile-row">
        <div class="avatar" aria-label="í”„ë¡œí•„ ì•„ì´ì½˜"></div>
        <div class="pmeta">
          <div class="pname">ê¶Œìœ ë¹ˆ</div>
          <div class="pdesc">8ì›”23 ~ 8ì›” 30 Â· ê°€ì¡± ì—¬í–‰</div>
          <div class="ptags">
            <span class="ptag">ì˜¤í‚¤ë‚˜ì™€ ğŸ‡¯ğŸ‡µ</span>
            <span class="ptag">ë°©ì½• ğŸ‡¹ğŸ‡­</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container kb-pad">
    <!-- ì§„í–‰ë¥  ì¹´ë“œ -->
    <div class="card">
      <div class="sec-title"><span class="ico">ğŸ¯</span>ì§„í–‰ë¥ </div>
      <div class="progress"><div class="bar"><i id="overallBar"></i></div></div>
      <small class="hint" id="saveStatus"></small>
    </div>

    <!-- 1. í™˜ìœ¨ -->
    <div class="card">
      <div class="sec-title"><span class="ico">ğŸ’±</span>1) í™˜ìœ¨ ê³„ì‚° í€´ì¦ˆ</div>
      <div class="row2">
        <input id="fxJPY" placeholder="10,000ì› â†’ â–  ì—” (JPY)"/>
        <input id="fxTHB" placeholder="10,000ì› â†’ â–  ë°”íŠ¸ (THB)"/>
      </div>
      <div class="field"><input id="fxBonus" placeholder="ë³´ë„ˆìŠ¤: 500ì—” â‰ˆ â–  ë°”íŠ¸"/></div>
      <div class="field"><input id="fxStarKRW" placeholder="â­ ì¶”ê°€ë¬¸ì œ: 500ë°”íŠ¸ëŠ” í•œêµ­ëˆìœ¼ë¡œ?(KRW)"/></div>
      <button class="btn-primary" data-sec="1">í™•ì •(ì €ì¥)</button>
    </div>

    <!-- 2. ì „ê¸° -->
    <div class="card">
      <div class="sec-title"><span class="ico">ğŸ”Œ</span>2) ì „ê¸° í”ŒëŸ¬ê·¸ & ì „ì••</div>
      <div class="row2">
        <input id="plugJP" placeholder="ì¼ë³¸: í”ŒëŸ¬ê·¸ íƒ€ì… / ì „ì••"/>
        <input id="plugTH" placeholder="íƒœêµ­: í”ŒëŸ¬ê·¸ íƒ€ì… / ì „ì••"/>
      </div>
      <div class="field"><input id="plugMe" placeholder="ë‚´ ì¶©ì „ê¸° í˜¸í™˜ ì—¬ë¶€(ì˜ˆ: 100â€“240V)"/></div>
      <button class="btn-primary" data-sec="2">í™•ì •(ì €ì¥)</button>
    </div>

    <!-- 3. ë‚ ì”¨ & ì˜·ì°¨ë¦¼ -->
    <div class="card">
      <div class="sec-title"><span class="ico">ğŸŒ¦ï¸</span>3) ë‚ ì”¨ & ì˜·ì°¨ë¦¼</div>
      <div class="row2">
        <input id="wxOKA" placeholder="ì˜¤í‚¤ë‚˜ì™€: ìµœì €/ìµœê³ /ê°•ìˆ˜"/>
        <input id="wxBKK" placeholder="ë°©ì½•: ìµœì €/ìµœê³ /ê°•ìˆ˜"/>
      </div>
      <div class="field"><textarea id="outfit" placeholder="ì˜·ì°¨ë¦¼/ì•„ì´í…œ (ë°˜íŒ”, ê°€ë””ê±´, ìŠ¬ë¦¬í¼, ìš°ì‚°, ëª¨ì, ì„ í¬ë¦¼ ë“±)"></textarea></div>
      <button class="btn-primary" data-sec="3">í™•ì •(ì €ì¥)</button>
    </div>

    <!-- 4. íšŒí™” -->
    <div class="card">
      <div class="sec-title"><span class="ico">ğŸ—£ï¸</span>4) ê°„ë‹¨ íšŒí™” ì¹´ë“œ</div>
      <div class="field"><textarea id="jpPhrases" placeholder="ì¼ë³¸ì–´ ë©”ëª¨ (ê°ì‚¬í•©ë‹ˆë‹¤ / ì–¼ë§ˆì˜ˆìš”? / ë§›ìˆì–´ìš” + ë°œìŒ)"></textarea></div>
      <div class="field"><textarea id="thPhrases" placeholder="íƒœêµ­ì–´ ë©”ëª¨ (ê°ì‚¬í•©ë‹ˆë‹¤ / ì–¼ë§ˆì˜ˆìš”? / ë§›ìˆì–´ìš” + ë°œìŒ)"></textarea></div>
      <button class="btn-primary" data-sec="4">í™•ì •(ì €ì¥)</button>
    </div>

    <!-- 5. í¸ì˜ì  -->
    <div class="card">
      <div class="sec-title"><span class="ico">ğŸ›’</span>5) í¸ì˜ì  í•„ìˆ˜í…œ</div>
      <div class="field"><textarea id="cOKA" placeholder="ì˜¤í‚¤ë‚˜ì™€ í¸ì˜ì  ë² ìŠ¤íŠ¸ 3 + ê°€ê²©"></textarea></div>
      <div class="field"><textarea id="cBKK" placeholder="ë°©ì½• í¸ì˜ì  ë² ìŠ¤íŠ¸ 3 + ê°€ê²©"></textarea></div>
      <button class="btn-primary" data-sec="5">í™•ì •(ì €ì¥)</button>
    </div>

    <!-- ë¹„ìƒì—°ë½ë§ -->
    <div class="card">
      <div class="sec-title"><span class="ico">ğŸ†˜</span>ë¹„ìƒì—°ë½ë§</div>
      <div style="display:grid;gap:8px">
        <div><strong>ì˜¤í‚¤ë‚˜ì™€(ê´€í• : ì£¼í›„ì¿ ì˜¤ì¹´ ì´ì˜ì‚¬ê´€)</strong><br/>
          ëŒ€í‘œì „í™”: <a href="tel:+81927710461">+81-92-771-0461</a>~2 Â· ê¸´ê¸‰(ì•¼ê°„/íœ´ì¼): <a href="tel:+818085882806">+81-80-8588-2806</a>
        </div>
        <div><strong>ë°©ì½•(ì£¼íƒœêµ­ ëŒ€í•œë¯¼êµ­ ëŒ€ì‚¬ê´€)</strong><br/>
          ëŒ€í‘œì „í™”: <a href="tel:+6624816000">+66-2-481-6000</a> Â· ê¸´ê¸‰(ê·¼ë¬´ì‹œê°„ ì™¸): <a href="tel:+66819145803">+66-81-914-5803</a>
        </div>
      </div>
      <small class="hint">* í˜„ì§€ í†µì‹ ì‚¬/ìš”ê¸ˆì— ë”°ë¼ í†µí™”ë£Œê°€ ë¶€ê³¼ë  ìˆ˜ ìˆì–´ìš”.</small>
    </div>

    <!-- 6. ë§ˆì§€ë§‰ ë©”ëª¨ì¥ -->
    <div class="card">
      <div class="sec-title"><span class="ico">ğŸ“</span>6) ë§ˆì§€ë§‰ ë©”ëª¨ì¥</div>
      <div class="field"><textarea id="memo6" placeholder="ì—¬í–‰ ë§ˆì§€ë§‰ ì ê²€ ë©”ëª¨(í™˜ì „, ì—¬ê¶Œ, íƒ‘ìŠ¹ê¶Œ, ì•½, ì¶©ì „ê¸°, ì„ ë¬¼ ë“±)"></textarea></div>
      <button class="btn-primary" data-sec="6">í™•ì •(ì €ì¥)</button>
    </div>
  </div>

  <!-- í•˜ë‹¨ ë°” -->
  <nav class="dock" role="toolbar" aria-label="ë¹ ë¥¸ ì‹¤í–‰">
    <button class="dock-btn" id="btnRefresh" aria-label="ìƒˆë¡œê³ ì¹¨"><span class="ico">ğŸ”„</span> ìƒˆë¡œê³ ì¹¨</button>
    <button class="dock-btn primary" id="btnQuickSave" aria-label="ì €ì¥í•˜ê¸°"><span class="ico">ğŸ’¾</span> ì €ì¥í•˜ê¸°</button>
    <button class="dock-btn" id="btnTop" aria-label="ë§¨ ìœ„ë¡œ"><span class="ico">ğŸ </span> ë§¨ìœ„ë¡œ</button>
  </nav>

  <div class="test-badge" id="testBadge">self-test: waiting</div>

  <!-- Firebase (Compat CDN) + Firestore -->
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <script>
    // ===== ê³µìš© í—¬í¼ =====
    const $ = (id) => document.getElementById(id);
    const statusNote = $('saveStatus');

    // ì§„í–‰ë¥  ê³„ì‚°
    function updateProgress(){
      const bar = $('overallBar');
      if(!bar) return; // ë°©ì–´ì½”ë“œ
      const checks = [
        true,
        $('fxJPY')?.value && $('fxTHB')?.value,
        $('plugJP')?.value && $('plugTH')?.value && $('plugMe')?.value,
        $('wxOKA')?.value && $('wxBKK')?.value && $('outfit')?.value,
        $('jpPhrases')?.value && $('thPhrases')?.value,
        $('cOKA')?.value && $('cBKK')?.value,
        $('fxStarKRW')?.value,
        $('memo6')?.value
      ];
      const filled = checks.filter(Boolean).length;
      const pct = Math.round(filled / checks.length * 100);
      bar.style.width = pct + '%';
      return pct;
    }

    // ì…ë ¥ ë³€í™” ì‹œ í•­ìƒ ê°±ì‹ 
    document.addEventListener('input', (e)=>{
      if(e.target.matches('input, textarea')) updateProgress();
    });

    // ===== Firebase ì´ˆê¸°í™” =====
    const firebaseConfig = {
      apiKey: "AIzaSyBu2rTUwtREkmXicazOXq9D7I6uBQOz87U",
      authDomain: "my-memo-90e91.firebaseapp.com",
      projectId: "my-memo-90e91",
      storageBucket: "my-memo-90e91.firebasestorage.app",
      messagingSenderId: "752429576474",
      appId: "1:752429576474:web:2afc83b95a8af5110c7ca3"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    db.enablePersistence({ synchronizeTabs: true }).catch(()=>{});

    let uid = null; let docRef = null; // users/{uid}/pretrip/data

    async function saveMerge(obj){
      if(!docRef) throw new Error('ë¡œê·¸ì¸ ì „');
      await docRef.set(obj, { merge: true });
      if(statusNote){ statusNote.textContent = 'ì €ì¥ë¨ âœ“'; setTimeout(()=> statusNote.textContent = '', 1200); }
      if (navigator.vibrate) navigator.vibrate(15);
    }

    async function quickSaveAll(){
      try{
        await saveMerge({
          sec1:{ fxJPY:$('fxJPY').value.trim(), fxTHB:$('fxTHB').value.trim(), fxBonus:$('fxBonus').value.trim(), fxStarKRW:$('fxStarKRW').value.trim() },
          sec2:{ plugJP:$('plugJP').value.trim(), plugTH:$('plugTH').value.trim(), plugMe:$('plugMe').value.trim() },
          sec3:{ wxOKA:$('wxOKA').value.trim(), wxBKK:$('wxBKK').value.trim(), outfit:$('outfit').value.trim() },
          sec4:{ jpPhrases:$('jpPhrases').value.trim(), thPhrases:$('thPhrases').value.trim() },
          sec5:{ cOKA:$('cOKA').value.trim(), cBKK:$('cBKK').value.trim() },
          sec6:{ memo:$('memo6').value.trim() },
          updatedAt: Date.now()
        });
        updateProgress();
      }catch(e){ alert('ì €ì¥ ì˜¤ë¥˜: '+(e?.message||e)); }
    }

    function bindSectionButtons(){
      document.querySelectorAll('button[data-sec]').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          const sec = Number(btn.dataset.sec);
          try{
            if(sec===1){ await saveMerge({ sec1:{ fxJPY:$('fxJPY').value.trim(), fxTHB:$('fxTHB').value.trim(), fxBonus:$('fxBonus').value.trim(), fxStarKRW:$('fxStarKRW').value.trim() }, updatedAt:Date.now() }); }
            if(sec===2){ await saveMerge({ sec2:{ plugJP:$('plugJP').value.trim(), plugTH:$('plugTH').value.trim(), plugMe:$('plugMe').value.trim() }, updatedAt:Date.now() }); }
            if(sec===3){ await saveMerge({ sec3:{ wxOKA:$('wxOKA').value.trim(), wxBKK:$('wxBKK').value.trim(), outfit:$('outfit').value.trim() }, updatedAt:Date.now() }); }
            if(sec===4){ await saveMerge({ sec4:{ jpPhrases:$('jpPhrases').value.trim(), thPhrases:$('thPhrases').value.trim() }, updatedAt:Date.now() }); }
            if(sec===5){ await saveMerge({ sec5:{ cOKA:$('cOKA').value.trim(), cBKK:$('cBKK').value.trim() }, updatedAt:Date.now() }); }
            if(sec===6){ await saveMerge({ sec6:{ memo:$('memo6').value.trim() }, updatedAt:Date.now() }); }
            updateProgress();
          } catch(e) {
            alert('ì €ì¥ ì˜¤ë¥˜: ' + (e?.message || e));
          }
        });
      });
    }

    // ì‹¤ì‹œê°„ ë°˜ì˜
    function hydrate(data){
      if(!data) return; 
      if(data.sec1?.fxJPY) $('fxJPY').value = data.sec1.fxJPY;
      if(data.sec1?.fxTHB) $('fxTHB').value = data.sec1.fxTHB;
      if(data.sec1?.fxBonus) $('fxBonus').value = data.sec1.fxBonus;
      if(data.sec1?.fxStarKRW) $('fxStarKRW').value = data.sec1.fxStarKRW;
      if(data.sec2?.plugJP) $('plugJP').value = data.sec2.plugJP;
      if(data.sec2?.plugTH) $('plugTH').value = data.sec2.plugTH;
      if(data.sec2?.plugMe) $('plugMe').value = data.sec2.plugMe;
      if(data.sec3?.wxOKA) $('wxOKA').value = data.sec3.wxOKA;
      if(data.sec3?.wxBKK) $('wxBKK').value = data.sec3.wxBKK;
      if(data.sec3?.outfit) $('outfit').value = data.sec3.outfit;
      if(data.sec4?.jpPhrases) $('jpPhrases').value = data.sec4.jpPhrases;
      if(data.sec4?.thPhrases) $('thPhrases').value = data.sec4.thPhrases;
      if(data.sec5?.cOKA) $('cOKA').value = data.sec5.cOKA;
      if(data.sec5?.cBKK) $('cBKK').value = data.sec5.cBKK;
      if(data.sec6?.memo) $('memo6').value = data.sec6.memo;
      updateProgress();
    }

    // ì‹œì‘: ë¡œê·¸ì¸ â†’ êµ¬ë… â†’ ë²„íŠ¼ ë°”ì¸ë”©
    (async function start(){
      try{
        const cred = await auth.signInAnonymously();
        uid = cred.user.uid;
        docRef = db.collection('users').doc(uid).collection('pretrip').doc('data');
        docRef.onSnapshot(snap => hydrate(snap.data()));
        bindSectionButtons();
      } catch(e) { alert('ì´ˆê¸°í™” ì˜¤ë¥˜: ' + (e?.message || e)); }
    })();

    // í•˜ë‹¨ ë°” ë™ì‘
    $('btnRefresh')?.addEventListener('click', ()=> location.reload());
    $('btnQuickSave')?.addEventListener('click', quickSaveAll);
    $('btnTop')?.addEventListener('click', ()=> { window.scrollTo({ top:0, behavior:'smooth' }); if (navigator.vibrate) navigator.vibrate(10); });

    // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js').catch(()=>{}); });
    }

    // iOS í‚¤ë³´ë“œ ë³´ì •
    if (window.visualViewport) {
      const vv = window.visualViewport; const body = document.body;
      const adjust = ()=>{ const kbOpen = window.innerHeight - vv.height > 120; body.style.paddingBottom = kbOpen ? 'calc(var(--dock-h) + 280px)' : 'calc(var(--dock-h) + env(safe-area-inset-bottom) + 12px)'; };
      vv.addEventListener('resize', adjust); vv.addEventListener('scroll', adjust);
    }

   
  </script>
</body>
</html>
